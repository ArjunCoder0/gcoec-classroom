<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - Engineering PYQ Portal</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            const originalWarn = console.warn;
            console.warn = function(...args) {
                if (args[0]?.includes?.('Tailwind')) return;
                originalWarn.apply(console, args);
            };
        }
        
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            "500":"#3b82f6",
                            "600":"#2563eb",
                            "700":"#1d4ed8",
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'heading': ['Poppins', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <!-- Header -->
    <header class="bg-gradient-to-r from-primary-600 to-primary-700 text-white shadow-lg">
        <div class="container mx-auto px-4 sm:px-6 py-4 sm:py-6">
            <div class="flex justify-between items-center">
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                            <i data-lucide="book-open" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h1 class="text-xl sm:text-2xl font-heading font-bold">GCOEC Classroom</h1>
                            <p class="text-xs sm:text-sm text-white/80" id="studentInfo">Loading...</p>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <a href="student_exams.html" class="px-3 sm:px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition flex items-center gap-2">
                        <i data-lucide="file-text" class="w-4 h-4"></i>
                        <span class="hidden sm:inline">Exams</span>
                    </a>
                    <a href="index.html" class="px-3 sm:px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition flex items-center gap-2">
                        <i data-lucide="home" class="w-4 h-4"></i>
                        <span class="hidden sm:inline">Portal</span>
                    </a>
                    <button onclick="studentLogout()" class="px-3 sm:px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition flex items-center gap-2">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                        <span class="hidden sm:inline">Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 py-6 sm:py-8">
        <!-- Welcome Section -->
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl shadow-lg p-6 sm:p-8 mb-8 text-white">
            <h2 class="text-2xl sm:text-3xl font-heading font-bold mb-2">
                Welcome back, <span id="studentName">Student</span>! ðŸ‘‹
            </h2>
            <p class="text-white/90">Here are your classes and assignments</p>
        </div>

        <!-- Quick Access Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
            <!-- Classroom Card -->
            <a href="student_classroom.html" class="card-hover bg-white rounded-xl shadow-md p-6 border-2 border-transparent hover:border-blue-500 transition">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="book-open" class="w-6 h-6 text-blue-600"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-900">Classroom</h3>
                        <p class="text-sm text-gray-600">View Classes</p>
                    </div>
                </div>
            </a>

            <!-- Exams Card -->
            <a href="student_exams.html" class="card-hover bg-white rounded-xl shadow-md p-6 border-2 border-transparent hover:border-green-500 transition">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="file-text" class="w-6 h-6 text-green-600"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-900">Exams</h3>
                        <p class="text-sm text-gray-600">Take Tests</p>
                    </div>
                </div>
            </a>

            <!-- PYQ Portal Card -->
            <a href="index.html" class="card-hover bg-white rounded-xl shadow-md p-6 border-2 border-transparent hover:border-orange-500 transition">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="archive" class="w-6 h-6 text-orange-600"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-900">PYQ Portal</h3>
                        <p class="text-sm text-gray-600">Past Papers</p>
                    </div>
                </div>
            </a>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center py-16">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"></div>
            <p class="mt-4 text-gray-600 font-medium">Loading your classes...</p>
        </div>

        <!-- Classes Grid -->
        <div id="classesContainer" class="hidden">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-heading font-bold text-gray-900 flex items-center gap-2">
                    <i data-lucide="book-open" class="w-6 h-6 text-primary-600"></i>
                    My Classes
                </h3>
            </div>
            <div id="classesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Classes will be loaded here -->
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-16 bg-white rounded-2xl shadow-sm">
            <i data-lucide="book-x" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
            <h3 class="text-xl font-bold text-gray-800 mb-2">No Classes Yet</h3>
            <p class="text-gray-600">Your classes will appear here once your admin creates them</p>
        </div>
    </main>

    <script src="student_auth.js"></script>
    <script>
        let studentData = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadDashboard();
        });

        // Load dashboard
        async function loadDashboard() {
            try {
                const token = localStorage.getItem('studentToken');
                if (!token) {
                    window.location.href = 'student_login.html';
                    return;
                }

                const response = await fetch(`${API_BASE_URL}/api/student/classes`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error('Failed to load classes');
                }

                studentData = data;
                displayStudentInfo();
                displayClasses(data.classes);

                document.getElementById('loadingState').classList.add('hidden');

                if (data.classes.length > 0) {
                    document.getElementById('classesContainer').classList.remove('hidden');
                } else {
                    document.getElementById('emptyState').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('emptyState').classList.remove('hidden');
            }
        }

        // Display student info
        function displayStudentInfo() {
            const studentInfo = JSON.parse(localStorage.getItem('studentInfo') || '{}');
            const name = studentInfo.name || 'Student';
            const branch = studentInfo.branch || '';
            const semester = studentInfo.semester || '';
            
            document.getElementById('studentName').textContent = name;
            document.getElementById('studentInfo').textContent = `${branch} - Semester ${semester}`;
        }

        // Display classes
        function displayClasses(classes) {
            const container = document.getElementById('classesList');
            container.innerHTML = '';

            classes.forEach(cls => {
                const classCard = document.createElement('div');
                classCard.className = 'bg-white rounded-xl shadow-sm overflow-hidden card-hover cursor-pointer';
                classCard.onclick = () => window.location.href = `student_classroom.html?id=${cls.id}`;

                classCard.innerHTML = `
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i data-lucide="book-open" class="w-6 h-6 text-white"></i>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">${cls.class_name}</h3>
                        <p class="text-gray-600 text-sm mb-4">${cls.description || 'No description'}</p>
                        <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                            <span class="flex items-center gap-1">
                                <i data-lucide="file-text" class="w-4 h-4"></i>
                                ${cls.notes_count || 0} Notes
                            </span>
                            <span class="flex items-center gap-1">
                                <i data-lucide="clipboard-list" class="w-4 h-4"></i>
                                ${cls.assignments_count || 0} Assignments
                            </span>
                        </div>
                        <button class="w-full bg-primary-600 text-white py-3 rounded-lg hover:bg-primary-700 transition font-semibold flex items-center justify-center gap-2">
                            <span>Open Class</span>
                            <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;

                container.appendChild(classCard);
            });

            lucide.createIcons();
        }

        // Logout
        function studentLogout() {
            localStorage.removeItem('studentToken');
            localStorage.removeItem('studentInfo');
            window.location.href = 'student_login.html';
        }
    </script>
</body>
</html>
