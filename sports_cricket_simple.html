<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="gcoec-logo.png">
    <title>GCOEC Sports - Cricket | Government College of Engineering, Chandrapur</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: { 500: '#0B3D91', 600: '#093478', 700: '#072b5f', 800: '#052246', 900: '#03192d' },
                        gold: { 500: '#f59e0b', 600: '#d97706' }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.1); }
        }
        .live-dot { animation: pulse-dot 2s ease-in-out infinite; }
        .match-card { transition: all 0.3s ease; cursor: pointer; }
        .match-card:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Live Badge
        const LiveBadge = () => (
            <div className="flex items-center gap-2 bg-red-500 text-white px-3 py-1 rounded-full font-bold text-xs">
                <span className="w-2 h-2 bg-white rounded-full live-dot"></span>
                LIVE
            </div>
        );

        // Match Card Component
        const MatchCard = ({ match, onClick }) => {
            const getStatusBadge = () => {
                if (match.match_status === 'live') return <LiveBadge />;
                if (match.match_status === 'completed') {
                    return <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full font-bold text-xs">COMPLETED</span>;
                }
                return <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-bold text-xs">UPCOMING</span>;
            };

            return (
                <div onClick={onClick} className="match-card bg-white rounded-xl shadow-md p-6 mb-4">
                    <div className="flex items-center justify-between mb-4">
                        <div>
                            <p className="text-xs text-gray-500 font-medium mb-1">{match.league || 'GCOEC Premier League'}</p>
                            <h3 className="text-lg font-bold text-gray-900">{match.match_id}</h3>
                        </div>
                        {getStatusBadge()}
                    </div>

                    <div className="grid grid-cols-2 gap-6">
                        <div>
                            <div className="flex items-center gap-2 mb-2">
                                <span className="text-2xl">{match.teamA.logo || 'üèè'}</span>
                                <h4 className="font-semibold text-gray-800">{match.teamA.name}</h4>
                            </div>
                            <div className="text-3xl font-bold text-navy-600">{match.teamA.score}</div>
                            <p className="text-sm text-gray-500">Overs: {match.teamA.overs}</p>
                        </div>

                        <div className="text-right">
                            <div className="flex items-center justify-end gap-2 mb-2">
                                <h4 className="font-semibold text-gray-800">{match.teamB.name}</h4>
                                <span className="text-2xl">{match.teamB.logo || 'üèè'}</span>
                            </div>
                            <div className="text-3xl font-bold text-navy-600">{match.teamB.score}</div>
                            <p className="text-sm text-gray-500">Overs: {match.teamB.overs}</p>
                        </div>
                    </div>

                    {match.match_status === 'completed' && match.result && (
                        <div className="mt-4 pt-4 border-t">
                            <p className="text-sm font-semibold text-green-600 text-center">{match.result}</p>
                        </div>
                    )}

                    {match.match_status === 'upcoming' && (
                        <div className="mt-4 pt-4 border-t text-sm text-gray-600">
                            <p><strong>Date:</strong> {match.match_date} at {match.match_time}</p>
                            <p><strong>Venue:</strong> {match.venue}</p>
                        </div>
                    )}

                    <div className="mt-4 text-center">
                        <button className="text-blue-600 hover:text-blue-700 font-semibold text-sm">
                            View Details ‚Üí
                        </button>
                    </div>
                </div>
            );
        };

        // Match Details View (when card is clicked)
        const MatchDetailsView = ({ match, onBack }) => {
            // Custom SVG Chart Component
            const RunProgressChart = ({ data }) => {
                if (!data || data.length === 0) return null;
                
                const width = 800;
                const height = 300;
                const padding = 50;
                const chartWidth = width - 2 * padding;
                const chartHeight = height - 2 * padding;

                const maxRuns = Math.max(...data.map(d => d.runs));
                const maxOvers = Math.max(...data.map(d => d.over));

                const getX = (over) => padding + (over / maxOvers) * chartWidth;
                const getY = (runs) => height - padding - (runs / maxRuns) * chartHeight;

                const pathData = data.map((point, i) => {
                    const x = getX(point.over);
                    const y = getY(point.runs);
                    return i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`;
                }).join(' ');

                return (
                    <div className="bg-white rounded-xl shadow-md p-6 mb-6">
                        <h3 className="text-xl font-bold text-gray-900 mb-6">Run Progress</h3>
                        <div className="overflow-x-auto">
                            <svg viewBox={`0 0 ${width} ${height}`} className="w-full" style={{maxWidth: '800px', margin: '0 auto'}}>
                                {[0, 1, 2, 3, 4].map(i => {
                                    const y = height - padding - (i * chartHeight / 4);
                                    return (
                                        <g key={`grid-${i}`}>
                                            <line x1={padding} y1={y} x2={width - padding} y2={y} stroke="#e5e7eb" strokeWidth="1" strokeDasharray="3,3" />
                                            <text x={padding - 10} y={y + 5} fill="#6b7280" fontSize="12" textAnchor="end">
                                                {Math.round((maxRuns / 4) * i)}
                                            </text>
                                        </g>
                                    );
                                })}
                                
                                {data.map((point, i) => {
                                    if (i % 2 === 0) {
                                        const x = getX(point.over);
                                        return (
                                            <text key={`x-${i}`} x={x} y={height - padding + 20} fill="#6b7280" fontSize="12" textAnchor="middle">
                                                {point.over}
                                            </text>
                                        );
                                    }
                                    return null;
                                })}
                                
                                <text x={width / 2} y={height - 5} fill="#6b7280" fontSize="12" fontWeight="600" textAnchor="middle">
                                    Overs
                                </text>
                                <text x={15} y={height / 2} fill="#6b7280" fontSize="12" fontWeight="600" textAnchor="middle" transform={`rotate(-90, 15, ${height / 2})`}>
                                    Runs
                                </text>
                                
                                <path d={pathData} stroke="#0B3D91" strokeWidth="3" fill="none" />
                                
                                {data.map((point, i) => (
                                    <circle
                                        key={`dot-${i}`}
                                        cx={getX(point.over)}
                                        cy={getY(point.runs)}
                                        r="4"
                                        fill="#0B3D91"
                                    />
                                ))}
                            </svg>
                        </div>
                    </div>
                );
            };

            const Scorecard = ({ batting, bowling }) => {
                if (!batting || !bowling) return null;
                
                return (
                    <div className="bg-white rounded-xl shadow-md p-6 mb-6">
                        <h3 className="text-xl font-bold text-gray-900 mb-4">Batting Performance</h3>
                        <div className="overflow-x-auto mb-8">
                            <table className="w-full text-sm">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="text-left py-3 px-4 font-semibold text-gray-700">Player</th>
                                        <th className="text-center py-3 px-4 font-semibold text-gray-700">R</th>
                                        <th className="text-center py-3 px-4 font-semibold text-gray-700">B</th>
                                        <th className="text-center py-3 px-4 font-semibold text-gray-700">4s</th>
                                        <th className="text-center py-3 px-4 font-semibold text-gray-700">6s</th>
                                        <th className="text-center py-3 px-4 font-semibold text-gray-700">SR</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {batting.map((player, idx) => (
                                        <tr key={idx} className="border-b border-gray-100 hover:bg-gray-50">
                                            <td className="py-3 px-4 font-medium text-gray-900">{player.player}</td>
                                            <td className="text-center py-3 px-4 text-gray-700">{player.r}</td>
                                            <td className="text-center py-3 px-4 text-gray-700">{player.b}</td>
                                            <td className="text-center py-3 px-4 text-gray-700">{player.fours}</td>
                                            <td className="text-center py-3 px-4 text-gray-700">{player.sixes}</td>
                                            <td className="text-center py-3 px-4 text-gray-700">{player.sr.toFixed(2)}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        <h3 className="text-xl font-bold text-gray-900 mb-4">Bowling Performance</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="text-left py-3 px-4 font-semibold text-gray-700">Player</th>
                                        <th className="text-center py-3 px-4 font-semibold text-gray-700">O</th>
                                        <th className="text-center py-3 px-4 font-semibold text-gray-700">R</th>
                                        <th className="text-center py-3 px-4 font-semibold text-gray-700">W</th>
                                        <th className="text-center py-3 px-4 font-semibold text-gray-700">Econ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {bowling.map((player, idx) => (
                                        <tr key={idx} className="border-b border-gray-100 hover:bg-gray-50">
                                            <td className="py-3 px-4 font-medium text-gray-900">{player.player}</td>
                                            <td className="text-center py-3 px-4 text-gray-700">{player.o}</td>
                                            <td className="text-center py-3 px-4 text-gray-700">{player.r}</td>
                                            <td className="text-center py-3 px-4 text-gray-700">{player.w}</td>
                                            <td className="text-center py-3 px-4 text-gray-700">{player.econ.toFixed(2)}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            const Commentary = ({ data }) => {
                if (!data || data.length === 0) return null;
                
                return (
                    <div className="bg-white rounded-xl shadow-md p-6 mb-6">
                        <h3 className="text-xl font-bold text-gray-900 mb-4">Live Commentary</h3>
                        <div className="space-y-3">
                            {data.map((comment, idx) => (
                                <div key={idx} className={`p-4 rounded-lg border-l-4 ${
                                    comment.type === 'wicket' ? 'bg-red-50 border-red-500' :
                                    comment.type === 'six' ? 'bg-purple-50 border-purple-500' :
                                    comment.type === 'four' ? 'bg-blue-50 border-blue-500' :
                                    'bg-gray-50 border-gray-300'
                                }`}>
                                    <div className="flex items-start gap-3">
                                        <span className="font-bold text-navy-600 text-sm">{comment.over}</span>
                                        <p className="text-gray-800 text-sm flex-1">{comment.text}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            return (
                <div>
                    <button onClick={onBack} className="mb-6 flex items-center gap-2 text-blue-600 hover:text-blue-700 font-semibold">
                        <span>‚Üê</span> Back to All Matches
                    </button>

                    <div className="bg-white rounded-xl shadow-md p-8 mb-6">
                        <div className="flex items-center justify-between mb-6">
                            <div>
                                <p className="text-sm text-gray-500 font-medium mb-1">{match.league || 'GCOEC Premier League'}</p>
                                <h1 className="text-2xl font-bold text-gray-900">
                                    {match.teamA.name} vs {match.teamB.name}
                                </h1>
                            </div>
                            {match.match_status === "live" && <LiveBadge />}
                        </div>

                        <div className="grid md:grid-cols-2 gap-8">
                            <div className="text-center md:text-left">
                                <div className="flex items-center justify-center md:justify-start gap-3 mb-3">
                                    <span className="text-4xl">{match.teamA.logo || 'üèè'}</span>
                                    <h2 className="text-xl font-semibold text-gray-800">{match.teamA.name}</h2>
                                </div>
                                <div className="text-5xl font-bold text-navy-600 mb-2">{match.teamA.score}</div>
                                <p className="text-gray-500 font-medium">Overs: {match.teamA.overs}</p>
                            </div>

                            <div className="text-center md:text-right">
                                <div className="flex items-center justify-center md:justify-end gap-3 mb-3">
                                    <h2 className="text-xl font-semibold text-gray-800">{match.teamB.name}</h2>
                                    <span className="text-4xl">{match.teamB.logo || 'üèè'}</span>
                                </div>
                                <div className="text-5xl font-bold text-navy-600 mb-2">{match.teamB.score}</div>
                                <p className="text-gray-500 font-medium">Overs: {match.teamB.overs}</p>
                            </div>
                        </div>

                        {match.match_status === "completed" && match.result && (
                            <div className="mt-6 text-center">
                                <p className="text-lg font-semibold text-green-600 bg-green-50 py-3 px-6 rounded-lg inline-block">
                                    {match.result}
                                </p>
                            </div>
                        )}
                    </div>

                    {match.runProgress && match.runProgress.length > 0 && <RunProgressChart data={match.runProgress} />}
                    {match.batting && match.bowling && <Scorecard batting={match.batting} bowling={match.bowling} />}
                    {match.commentary && match.commentary.length > 0 && <Commentary data={match.commentary} />}
                </div>
            );
        };

        // API Base URL
        const API_URL = '/api/cricket';  // Always use absolute path from root

        // Main App
        const CricketSportsApp = () => {
            const [matches, setMatches] = useState([]);
            const [selectedMatch, setSelectedMatch] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            // Load matches from backend API
            useEffect(() => {
                const loadMatches = async () => {
                    try {
                        setError(null);
                        
                        // Try backend API first
                        console.log('Fetching from:', `${API_URL}/matches`);
                        const response = await fetch(`${API_URL}/matches`);
                        
                        console.log('Response status:', response.status);
                        console.log('Response headers:', response.headers.get('content-type'));
                        
                        if (response.ok) {
                            const contentType = response.headers.get('content-type');
                            if (contentType && contentType.includes('application/json')) {
                                const result = await response.json();
                                console.log('API Response:', result);
                                
                                if (result.success && result.data.length > 0) {
                                    // Sort: live first, then upcoming, then completed
                                    const sorted = result.data.sort((a, b) => {
                                        const order = { live: 0, upcoming: 1, completed: 2 };
                                        return order[a.match_status] - order[b.match_status];
                                    });
                                    setMatches(sorted);
                                    setLoading(false);
                                    return;
                                }
                            } else {
                                console.warn('API returned non-JSON response');
                            }
                        }
                        
                        // Fallback to localStorage if API fails
                        console.log('API failed, falling back to localStorage');
                        const storedMatches = JSON.parse(localStorage.getItem('cricket_matches') || '[]');
                        
                        if (storedMatches.length > 0) {
                            const sorted = storedMatches.sort((a, b) => {
                                const order = { live: 0, upcoming: 1, completed: 2 };
                                return order[a.match_status] - order[b.match_status];
                            });
                            setMatches(sorted);
                        } else {
                            setMatches([]);
                        }
                        
                    } catch (err) {
                        console.error('Error loading matches:', err);
                        
                        // Fallback to localStorage on error
                        const storedMatches = JSON.parse(localStorage.getItem('cricket_matches') || '[]');
                        if (storedMatches.length > 0) {
                            const sorted = storedMatches.sort((a, b) => {
                                const order = { live: 0, upcoming: 1, completed: 2 };
                                return order[a.match_status] - order[b.match_status];
                            });
                            setMatches(sorted);
                        } else {
                            setMatches([]);
                        }
                        setError('Using cached data. Live updates may not be available.');
                    } finally {
                        setLoading(false);
                    }
                };

                loadMatches();
                
                // Auto-refresh every 5 seconds
                const interval = setInterval(loadMatches, 5000);
                return () => clearInterval(interval);
            }, []);

            if (selectedMatch) {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <header className="bg-white shadow-sm sticky top-0 z-50">
                            <div className="max-w-7xl mx-auto px-4 py-4">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-4">
                                        <img src="gcoec-logo.png" alt="GCOEC Logo" className="w-12 h-12 object-contain" />
                                        <div>
                                            <h1 className="text-xl font-bold text-navy-900">GCOEC Sports</h1>
                                            <p className="text-xs text-gray-600">Cricket Championship</p>
                                        </div>
                                    </div>
                                    <a href="index.html" className="text-navy-600 hover:text-navy-700 font-semibold text-sm flex items-center gap-1">
                                        <span>‚Üê Back to Portal</span>
                                    </a>
                                </div>
                            </div>
                        </header>

                        <main className="max-w-7xl mx-auto px-4 py-8">
                            <MatchDetailsView match={selectedMatch} onBack={() => setSelectedMatch(null)} />
                        </main>

                        <footer className="bg-navy-900 text-white py-8 mt-12">
                            <div className="max-w-7xl mx-auto px-4 text-center">
                                <p className="text-sm text-gray-300">¬© 2026 Government College of Engineering, Chandrapur - Sports Department</p>
                                <p className="text-xs text-gray-400 mt-2">Official GCOEC Premier League Platform</p>
                            </div>
                        </footer>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="bg-white shadow-sm sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <img src="gcoec-logo.png" alt="GCOEC Logo" className="w-12 h-12 object-contain" />
                                    <div>
                                        <h1 className="text-xl font-bold text-navy-900">GCOEC Sports</h1>
                                        <p className="text-xs text-gray-600">Cricket Championship</p>
                                    </div>
                                </div>
                                <a href="index.html" className="text-navy-600 hover:text-navy-700 font-semibold text-sm flex items-center gap-1">
                                    <span>‚Üê Back to Portal</span>
                                </a>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 py-8">
                        <div className="mb-8">
                            <h2 className="text-3xl font-bold text-gray-900 mb-2">Live Matches</h2>
                            <p className="text-gray-600">Click on any match to view detailed scorecard and commentary</p>
                        </div>

                        {error && (
                            <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                                <div className="flex">
                                    <div className="flex-shrink-0">
                                        <svg className="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                            <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                        </svg>
                                    </div>
                                    <div className="ml-3">
                                        <p className="text-sm text-yellow-700">{error}</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {loading ? (
                            <div className="text-center py-12">
                                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-navy-600 mx-auto"></div>
                                <p className="mt-4 text-gray-600">Loading matches...</p>
                            </div>
                        ) : matches.length === 0 ? (
                            <div className="bg-white rounded-xl shadow-md p-12 text-center">
                                <div className="text-6xl mb-4">üèè</div>
                                <h3 className="text-2xl font-bold text-gray-900 mb-2">No Matches Available</h3>
                                <p className="text-gray-600 mb-6">There are no cricket matches scheduled at the moment.</p>
                                <p className="text-sm text-gray-500">Check back later or contact the sports department for updates.</p>
                            </div>
                        ) : (
                            <div className="grid md:grid-cols-2 gap-6">
                                {matches.map((match, idx) => (
                                    <MatchCard 
                                        key={match.match_id || idx} 
                                        match={match} 
                                        onClick={() => setSelectedMatch(match)}
                                    />
                                ))}
                            </div>
                        )}
                    </main>

                    <footer className="bg-navy-900 text-white py-8 mt-12">
                        <div className="max-w-7xl mx-auto px-4 text-center">
                            <p className="text-sm text-gray-300">¬© 2026 Government College of Engineering, Chandrapur - Sports Department</p>
                            <p className="text-xs text-gray-400 mt-2">Official GCOEC Premier League Platform</p>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CricketSportsApp />);
        
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
</body>
</html>
